/* ===== Global helpers ===== */
:root{
  --violet:#5b21b6;
  --violet-2:#4c1d95;
  --lav:#e9dcff;
  --white:#ffffff;
}

/* Generic hidden utility so .classList.add('hidden') works everywhere */
.hidden{ display:none !important; }

#bg-video{ position:fixed; inset:0; width:100%; height:100%; object-fit:cover; z-index:-2; }
.scrim{ position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45)); z-index:-1; }
.stage{ min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:6vh 4vw; box-sizing:border-box; overflow:hidden; }
.panel{ width:min(100%, 980px); display:flex; flex-direction:column; align-items:center; gap:2.2vh; }

/* заглавие */
.title{
  color:var(--lav); text-shadow:0 6px 18px rgba(0,0,0,.4);
  font-weight:900; letter-spacing:.04em; text-align:center; line-height:1.05;
  font-size: clamp(1.6rem, 5.5vw, 3.5rem);
  animation: slideInFromRight .9s cubic-bezier(.22,1,.36,1) both;
}

/* текстово поле */
.q-wrap{ width:100%; display:flex; justify-content:center; }
#qText{
  width:60vw; max-width:900px; min-width:min(60vw, 900px);
  min-height: calc(1lh * 3 + 1.25rem);
  max-height: calc(1lh * 3 + 1.25rem);
  padding:1rem 1.15rem; resize:vertical; border-radius:18px; border:2px solid rgba(255,255,255,.65);
  background: rgba(255,255,255,.9);
  font-size:clamp(1rem, 2.2vw, 1.15rem); line-height:1.35; box-shadow:0 10px 28px rgba(0,0,0,.18);
  animation: slideInFromLeft .9s .15s cubic-bezier(.22,1,.36,1) both;
}

.place-label{
  color:#fff; font-weight:400; letter-spacing:.02em; text-align:center;
  font-size: clamp(0.95rem, 2.2vw, 1.25rem);
  animation: slideInFromRight .8s .25s cubic-bezier(.22,1,.36,1) both;
}

.row{ display:flex; gap:.6rem; width:min(74vw, 980px); justify-content:center; align-items:center; }
.row input[type="text"]{
  flex: 0 1 calc(min(74vw, 980px) * .5);
  padding:.75rem 1rem; border-radius:14px; border:2px solid rgba(255,255,255,.7);
  background:#fff; font-size:1.05rem; box-shadow:0 8px 22px rgba(0,0,0,.15);
  animation: slideInFromLeft .8s .32s cubic-bezier(.22,1,.36,1) both;
}
.row button{
  padding:.8rem 1.2rem; border-radius:999px; border:none; cursor:pointer; font-weight:800; font-size:1rem;
  background:linear-gradient(135deg, #dcd0ff 0%, var(--violet) 100%); color:#fff; box-shadow:0 10px 26px rgba(91,33,182,.35);
  animation: slideInFromLeft .7s .38s cubic-bezier(.22,1,.36,1) both;
}

/* DST ред */
.dst-row{ display:flex; align-items:center; gap:.45rem; margin-top:.25rem; }
#dstCheck{ transform: scale(1.05); }
#dstLabel{
  color:#fff; font-weight:700; letter-spacing:.02em; cursor:pointer;
  animation: rtlFloat .9s cubic-bezier(.22,1,.36,1) both; /* отдясно наляво, стоп по средата */
}

/* падащо меню – по-голямо и красиво */
#qCityResults{
  width: calc(min(74vw, 980px) * .5);
  margin:.45rem auto 0; padding:.7rem; border-radius:16px; border:2px solid #cbd5e1;
  background:#fff; font-size:1.05rem; box-shadow:0 14px 32px rgba(0,0,0,.18);
  display:none; animation: fadeIn .35s ease-out both;
}
#qCityResults:focus{ outline:none; }

/* бутон ЗАДАЙ ВЪПРОС – по-дълъг */
.cta-main{
  margin-top:.8rem; padding:1rem 3.6rem;
  border-radius:26px; border:none; cursor:pointer; font-weight:900; letter-spacing:.02em;
  font-size: clamp(1.1rem, 3vw, 1.5rem);
  background:linear-gradient(135deg, #f3ecff 0%, #7c3aed 100%); color:#fff; box-shadow:0 14px 34px rgba(124,58,237,.36);
  animation: slideUp .7s .42s cubic-bezier(.22,1,.36,1) both;
}
.cta-main:disabled{ opacity:.65; cursor:not-allowed; }

/* Reveal сцена */
.reveal.hidden{ display:none; }
.reveal{ width:100%; display:flex; flex-direction:column; align-items:center; gap:1rem; }
.reveal-title{ color:#fff; font-weight:900; font-size:clamp(1.6rem,5.2vw,3.4rem); text-align:center; white-space:pre-wrap; }
.reveal-media{ width:100%; display:flex; justify-content:center; align-items:center; }
.reveal-video, .reveal-chart{ max-height:60vh; max-width:min(92vw, 1100px); border-radius:18px; box-shadow:0 18px 46px rgba(0,0,0,.35); }

/* Анимации */
@keyframes slideInFromRight{ from{ transform:translateX(50vw); opacity:0 } to{ transform:none; opacity:1 } }
@keyframes slideInFromLeft { from{ transform:translateX(-50vw); opacity:0 } to{ transform:none; opacity:1 } }
@keyframes slideUp{ from{ transform:translateY(10vh); opacity:0 } to{ transform:none; opacity:1 } }
@keyframes fadeIn{ from{ opacity:0 } to{ opacity:1 } }
@keyframes rtlFloat{ from{ transform:translateX(50vw); opacity:0 } to{ transform:none; opacity:1 } }
@keyframes ltrFloat{ from{ transform:translateX(-50vw); opacity:0 } to{ transform:none; opacity:1 } }

/* за входящите елементи в reveal сцена */
.reveal-title{ animation: rtlFloat .9s both; }
.reveal-video{ animation: ltrFloat .9s .05s both; }

/* Mobile */
@media (max-width:900px){
  .stage{ padding:5vh 5vw; }
  #qText{ width:86vw; min-width:86vw; }
  .row{ width:90vw; }
  .row input[type="text"]{ flex-basis: 45vw; }
  #qCityResults{ width:45vw; }
}

/* контейнер около полето за град */
.city-field{
  position: relative;
  /* същата ширина като преди, но в контейнер */
  flex: 0 1 calc(min(74vw, 980px) * .5);
}

/* полето за град вътре в .city-field */
.city-field > input{
  width: 100%;
  padding:.75rem 1rem;
  border-radius:14px; border:2px solid rgba(255,255,255,.7);
  background:#fff; font-size:1.05rem; box-shadow:0 8px 22px rgba(0,0,0,.15);
}

/* падащо меню – да пада надолу, върху другите елементи, скролируемо */
#qCityResults{
  position: absolute;
  left: 0;
  top: calc(100% + 6px);
  width: 115%;                 /* малко по-широко от инпута */
  max-height: 260px;           /* скрол при много елементи */
  overflow: auto;
  margin:0; padding:.6rem;
  border-radius:16px; border:2px solid #cbd5e1;
  background:#fff; font-size:1.05rem;
  box-shadow:0 16px 36px rgba(0,0,0,.22);
  z-index: 50;
  display: none;               /* показва се с JS */
  appearance: none;            /* скриваме системната стрелка */
  background-image: linear-gradient(180deg, #ffffff, #ffffff);
}

/* „стрелка надолу“ вътре в самия select */
#qCityResults.select-with-arrow{
  background-image:
    url("data:image/svg+xml,%3Csvg fill='none' stroke='%235b21b6' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right .75rem center;
  background-size: 1.05rem;
  padding-right: 2.2rem;       /* място за стрелката */
}

/* мобилно – да не излиза от екрана */
@media (max-width:900px){
  .city-field{ flex-basis: 86vw; }
  #qCityResults{ width: 100%; }
}

/* контейнер за полето и списъка */
.city-field{
  position: relative;
  flex: 0 1 calc(min(74vw, 980px) * .5);
}

/* инпутът за град */
.city-field > #qCity{
  width: 100%;
}

/* падащото меню – пада надолу, overlay, по-широко и скролируемо */
#qCityResults{
  position: absolute;
  left: 0;
  top: calc(100% + 6px);
  width: 115%;                 /* малко по-широко от инпута */
  max-height: 260px;           /* скрол при много елементи */
  overflow: auto;
  margin: 0;
  padding: .7rem;
  border-radius: 16px;
  border: 2px solid #cbd5e1;
  background: #fff;
  font-size: 1.05rem;
  box-shadow: 0 16px 36px rgba(0,0,0,.22);
  z-index: 50;
  display: none;               /* показва се от horary.js */
  appearance: none;            /* за да работи стрелката */
}

/* стрелка надолу в самия <select> */
.select-with-arrow{
  background-image:
    url("data:image/svg+xml,%3Csvg fill='none' stroke='%235b21b6' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right .75rem center;
  background-size: 1.05rem;
  padding-right: 2rem; /* място за стрелката */
}

/* мобилно – да не излиза от екрана */
@media (max-width:900px){
  .city-field{ flex-basis: 86vw; }
  #qCityResults{ width: 100%; }
}

/* ===== Added for loading + result transitions (keep existing code intact) ===== */
.reveal{ position: relative; overflow: hidden; }
.reveal-video.from-top{ animation: dropFromTop 0.9s cubic-bezier(.22,1,.36,1) both; }
@keyframes dropFromTop{
  from{ transform: translateY(-80vh); opacity:0; }
  to{   transform: translateY(-12vh); opacity:1; } /* stop slightly above center */
}
.gen-label{
  position: fixed;
  left: 0; right: 0; bottom: 6vh;
  text-align:center;
  font-weight:900;
  letter-spacing:.04em;
  font-size: clamp(1.2rem, 4.5vw, 2.2rem);
  color:#fff;
  text-shadow:0 8px 24px rgba(0,0,0,.55);
  animation: riseFromBottom .9s cubic-bezier(.22,1,.36,1) both;
  pointer-events: none;
}
@keyframes riseFromBottom{
  from{ transform: translateY(8vh); opacity:0; }
  to{   transform: translateY(0);    opacity:1; }
}

/* Result stage */
.result.hidden{ display:none; }
.result{ width:100%; display:flex; flex-direction:column; align-items:center; gap:1.2rem; }
.result-title{
  color:#fff; font-weight:900; text-align:center;
  font-size: clamp(1.6rem, 5.2vw, 3.4rem);
  white-space:pre-wrap;
  text-shadow:0 6px 18px rgba(0,0,0,.35);
}
.result-wrap{
  width:min(92vw, 1100px);
  position: relative;
  background: rgba(40, 9, 57, 0.4);
  color:#fff;
  border-radius: 18px;
  box-shadow:0 18px 46px rgba(0,0,0,.35);
  padding:1rem 1.25rem 1.25rem 1.25rem;
}

/* Chart floats top-left so text wraps to the right, then flows under it */
.result-chart{
  float: left;
  width: min(36vw, 320px);
  height: auto;
  border-radius: 14px;
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
  margin: 0 1.1rem .9rem 0;   /* space to the right and below */
}

/* Text should start right of the chart, then continue full width under it */
.result-text{
  line-height: 1.6;
  font-size: 1rem;
}

/* Contain the float */
.result-wrap::after{
  content: "";
  display: table;
  clear: both;
}

@media (max-width: 860px){
  .result-chart{
    float: none;
    display: block;
    margin: 0 auto 1rem;
    width: min(78vw, 440px);
  }
}


/* ===== Update: center reveal media and spin video after dropping ===== */
.reveal .reveal-media{
  min-height: 100vh;
  display: grid;
  place-items: center;
  position: relative;
}

/* New composite animation:
   1) dropToCenter: from top off-screen to perfect center (0.9s)
   2) spinForever: continuous rotation, starts right after drop finishes */
@keyframes dropToCenter{
  from{ transform: translateY(-100vh); opacity:0; }
  to{   transform: translateY(0);      opacity:1; }
}

/* ===== Fullscreen overlay for loading ===== */
.full-overlay{
  position: fixed;
  inset: 0;
  display: none; /* start hidden, shown via JS */
  align-items: center;
  justify-content: center;
  z-index: 2147483647;
  background: rgba(0, 0, 0, 0.65);
  color: #fff;
  font-weight: 900;
  letter-spacing: .05em;
  text-align: center;
  text-shadow: 0 10px 28px rgba(0,0,0,.6);
  font-size: clamp(1.6rem, 5.4vw, 3.2rem);
  user-select: none;
}

@keyframes overlayFadeOut{
  from{ opacity:1 }
  to{   opacity:0 }
}
.full-overlay.fade-out{
  animation: overlayFadeOut .35s ease forwards;
}


/* === Animated "ГЕНЕРИРАНЕ..." label (no overlay) === */
#generateLabel {
  position: fixed;
  top: 50%;
  left: -100%;
  transform: translateY(-50%);
  font-weight: 900;
  font-size: clamp(1.4rem, 4.6vw, 3rem);
  color: #fff;
  text-shadow: 0 10px 28px rgba(0,0,0,0.6);
  white-space: nowrap;
  display: none; /* shown via JS */
  z-index: 2147483000;
}
#generateLabel.is-on {
  display: block;
  animation: genMove 1.8s forwards;
}
@keyframes genMove {
  0%   { left: -100%; transform: translate(-0%, -50%); }
  70%  { left: 50%;   transform: translate(-50%, -50%); }
  100% { left: 50%;   transform: translate(-50%, -50%); }
}


/* === Ensure only video + label visible while generating === */
body.generating #bg-video{ display:block !important; }
body.generating #generateLabel{ display:block !important; }
body.generating > :not(#bg-video):not(#generateLabel):not(#chatbot){ display:none !important; }

/* Стил за надписа "ГЕНЕРИРАНЕ..." */
#generateLabel {
  font-size: 5rem;
  font-weight: bold;
  color: #f8c8dc; /* бледо розово */
  text-shadow: 2px 2px 8px rgba(200, 100, 200, 0.8); /* розово-лилава сянка */
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: none;
  z-index: 1000;
}

/* Текстът при показване на overlay */
body.generating #generateLabel {
  display: block !important;
}

/* Поле с резултата */
#resultText {
  background-color: rgba(48, 0, 64, 0.8); /* тъмно лилаво с 0.8 прозрачност */
  padding: 1rem;
  border-radius: 8px;
  color: #fff;
}

/* Картинката на наталната карта - квадратна 1:1 */
#natalImg,
#resultNatalImg {
  aspect-ratio: 1 / 1;
  object-fit: contain;
}

/* === Chat widget (same as began) === */

.chat-popup {
  position: fixed;
  right: 20px;
  bottom: 84px; /* над бутона */
  width: 360px;
  max-width: calc(100vw - 32px);
  height: 480px;
  max-height: calc(100vh - 120px);
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(0, 0, 0, .35);
  z-index: 99999;
  display: none;
  flex-direction: column;
}
.chat-popup.open { display: flex; }
.chat-head{ background: linear-gradient(135deg,#6c5ce7 0%, #9b8cff 100%); color:#fff; padding:12px 12px; display:flex; align-items:center; gap:10px; }
.chat-head h3{ font:600 13px/1.2 system-ui, Segoe UI, Roboto, Arial; margin:0; flex:1; letter-spacing:.2px; }
.chat-head button{ border:0; background:rgba(255,255,255,.18); color:#fff; width:28px; height:28px; border-radius:8px; cursor:pointer; }
.chat-log{ flex:1; padding:12px 12px 14px; overflow:auto; background: linear-gradient(180deg,#f8f6ff 0%, #f3f0ff 100%); }
.msg{ margin:8px 0; display:flex; gap:8px; align-items:flex-end; }
.msg .role{ font-size:10px; color:#888; margin-bottom:3px; }
.msg .text{ max-width:80%; white-space:pre-wrap; font:13px/1.45 system-ui, Segoe UI, Roboto, Arial; background:#fff; border:1px solid #eee; border-radius:14px; padding:8px 10px; box-shadow:0 2px 10px rgba(17,12,46,.06); }
.chat-form{ display:flex; gap:8px; padding:10px; border-top:1px solid #eee; background:#fff; }
.chat-input{ flex:1; padding:10px; border:1px solid #ddd; border-radius:10px; font:14px/1.2 system-ui, Segoe UI, Roboto, Arial; }
.chat-send{ padding:10px 14px; border-radius:10px; border:0; background:#111; color:#fff; cursor:pointer; font-size:13px; }
@media (max-width: 480px){
  .chat-popup{ right:12px; bottom:80px; width:calc(100vw - 24px); height:60vh; }
}
.chat-fab{
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  z-index: 100000; /* по-висок от всичко друго */
  padding: 0;
  background: linear-gradient(135deg, #ffb37a 0%, #ff5ca8 100%);
  box-shadow: 0 10px 25px rgba(0,0,0,.25);
  transition: transform .15s ease, box-shadow .15s ease;
}
.chat-fab img{ width:100%; height:100%; border-radius:50%; display:block; }
.chat-fab:hover{ transform: translateY(-2px); box-shadow: 0 14px 30px rgba(0,0,0,.3); }
.msg.user{ justify-content:flex-end; }
.msg.user .text{ background: linear-gradient(135deg,#6c5ce7 0%, #9b8cff 100%); color:#fff; border: none; box-shadow: 0 4px 16px rgba(108,92,231,.25); border-bottom-right-radius:6px; border-top-left-radius:16px; border-top-right-radius:16px; border-bottom-left-radius:16px; }
.msg.bot .text{ background:#fff; color:#1b1630; border:1px solid #ece7ff; border-bottom-left-radius:6px; border-top-right-radius:16px; }


/* === Astro credits icon sizing === */
.credit-icon{
  display:inline-block;
  width: 22px;
  height: 22px;
  vertical-align: -4px;
  object-fit: contain;
}
.credit-icon--2x{
  width: 44px;
  height: 44px;
}

/* Ensure the icon inside the primary CTA sits nicely */
#askBtn .credit-icon{ margin-left:.55rem; filter: drop-shadow(0 2px 6px rgba(0,0,0,.25)); }

/* === Styled credits modal (matches site palette) === */
.credits-modal.hidden{ display:none !important; }
.credits-modal{
  position: fixed;
  inset: 0;
  z-index: 2147483600;
  display: grid;
  place-items: center;
}
.credits-modal__backdrop{
  position:absolute;
  inset:0;
  background: rgba(12, 1, 20, .55);
  backdrop-filter: blur(2px);
}
.credits-modal__card{
  position: relative;
  width: min(92vw, 640px);
  border-radius: 20px;
  background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(245,240,255,.9));
  box-shadow: 0 30px 70px rgba(91,33,182,.45);
  border: 2px solid rgba(155,140,255,.6);
  overflow: hidden;
  animation: fadeIn .35s ease-out both;
}
.credits-modal__head{
  background: linear-gradient(135deg, #f3ecff 0%, var(--violet) 100%);
  color: #fff;
  padding: 16px 20px;
}
.credits-modal__head h3{
  margin:0; font-weight:900; letter-spacing:.02em;
}
.credits-modal__body{
  padding: 18px 22px 6px 22px;
  color:#1b1630;
  font: 500 1.05rem/1.5 system-ui, Segoe UI, Roboto, Inter, Arial, sans-serif;
}
.credits-line{
  display: flex;
  align-items: center;
  gap: .5rem;
  margin: .35rem 0 .65rem;
}
.credits-modal__actions{
  display:flex;
  justify-content:flex-end;
  gap:.6rem;
  padding: 14px 18px 18px;
}
.btn-primary, .btn-secondary{
  padding:.75rem 1.2rem;
  border-radius: 14px;
  border: 0;
  cursor: pointer;
  font-weight: 800;
  letter-spacing:.02em;
}
.btn-primary{
  color:#fff;
  background: linear-gradient(135deg, #f3ecff 0%, #7c3aed 100%);
  box-shadow: 0 10px 24px rgba(124,58,237,.28);
}
.btn-secondary{
  background:#fff;
  color:#1b1630;
  border: 2px solid #e6e0ff;
}
@media (max-width:520px){
  .credit-icon{ width:20px; height:20px; }
  .credit-icon--2x{ width:40px; height:40px; }
  .credits-modal__body{ font-size:1rem; }
}


/* === Enlarge existing credit icon inside the "ЗАДАЙ ВЪПРОС" button (2×) === */
#askBtn img[src*="zodiac_circle_money"]{
  display:inline-block;
  width: 44px !important;
  height: 44px !important;
  vertical-align: -4px;
  object-fit: contain;
  margin-left:.55rem;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.25));
}
@media (max-width:520px){
  #askBtn img[src*="zodiac_circle_money"]{ width:40px !important; height:40px !important; }
}


/* Text label after the credit icon inside the ask button */
#askBtn .ask-credits-label{
  margin-left: .35rem;
  font-weight: 700;
  letter-spacing: .01em;
  white-space: nowrap;
}

/* бутон ЗАДАЙ ВЪПРОС */
.cta-main{
  margin-top:.8rem; padding:1rem 3.6rem;
  border-radius:26px; border:none; cursor:pointer; font-weight:900; letter-spacing:.02em;
  font-size: clamp(1.1rem, 3vw, 1.5rem);
  background:linear-gradient(135deg, #f3ecff 0%, #7c3aed 100%); color:#fff; box-shadow:0 14px 34px rgba(124,58,237,.36);
  animation: slideUp .7s .42s cubic-bezier(.22,1,.36,1) both;

  /* нови редове за вертикално центриране */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .55rem;
  line-height: 1.1;
}
.ask-credits-label{ display:inline-flex; align-items:center; }
.ask-credits-label .amt{ font-weight: 900; }